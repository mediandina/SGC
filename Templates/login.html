<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ingreso al Sistema | SGC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sistema.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
</head>
<body>

<div class="login-wrapper">
    <!-- Header opcional con logo -->
    <div class="login-header">
        <!-- Descomenta si tienes logo -->
        <!-- <img src="ruta/a/logo.png" alt="SGC Logo" class="logo"> -->
        <h1>
            <span class="primary">Sistema de</span>
            <span class="secondary">Gestión de Cupos</span>
        </h1>
    </div>

    <div class="login-card">
        <h2 class="form-title">Ingreso al Sistema</h2>
        <p class="form-subtitle">Ingresa tus credenciales para continuar</p>

        <!-- Mensajes de éxito/error (Flask flash messages) -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{{ 'success-banner' if category == 'success' else 'error-banner' }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="POST" action="{{ url_for('login') }}" id="loginForm" novalidate>
            <!-- Teléfono (ahora se usa teléfono + contraseña para login) -->
            <div class="dmforminput required">
                <label for="telefono">Teléfono</label>
                <input 
                    type="tel" 
                    id="telefono" 
                    name="telefono" 
                    maxlength="10" 
                    required
                    placeholder="3001234567"
                    pattern="[0-9]{10}"
                    autocomplete="username"
                    aria-describedby="telefono-hint telefono-error">
                <span class="input-hint" id="telefono-hint">10 dígitos sin espacios ni guiones</span>
                <span class="error-message" id="telefono-error"></span>
            </div>

            <!-- Contraseña -->
            <div class="dmforminput required password-toggle">
                <label for="password">Contraseña</label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    required
                    placeholder="Ingresa tu contraseña"
                    autocomplete="current-password"
                    aria-describedby="password-error">
                <button 
                    type="button" 
                    class="toggle-password-btn" 
                    onclick="togglePassword()"
                    aria-label="Mostrar u ocultar contraseña">
                    Mostrar
                </button>
                <span class="error-message" id="password-error"></span>
            </div>

            <!-- Botón de envío -->
            <div class="dmformsubmit">
                <button type="submit">Ingresar</button>
            </div>
        </form>

        <!-- Link para registro -->
        <div class="registro-link">
            ¿No tienes cuenta?
            <a href="{{ url_for('registro') }}">Registrarse</a>
        </div>
    </div>

    <div class="login-footer">
    <p>
        ¿Olvidaste tu contraseña?
        <span class="contacto-admin">
            Contacta al <a href="tel:+573138893206"> 313 889 3206</a>
        </span>
    </p>
</div>


<script>
    // Toggle mostrar/ocultar contraseña
    function togglePassword() {
        const passwordInput = document.getElementById('password');
        const toggleBtn = document.querySelector('.toggle-password-btn');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleBtn.textContent = 'Ocultar';
        } else {
            passwordInput.type = 'password';
            toggleBtn.textContent = 'Mostrar';
        }
    }

    // Validación en tiempo real
    const form = document.getElementById('loginForm');
    const inputs = form.querySelectorAll('input[required]');

    // Validar campo individual
    function validateField(field) {
        const errorSpan = document.getElementById(`${field.id}-error`);
        let errorMessage = '';

        // Limpiar error previo
        field.classList.remove('input-error');
        if (errorSpan) errorSpan.textContent = '';

        // Validaciones específicas
        if (!field.value.trim()) {
            errorMessage = 'Este campo es obligatorio';
        } else if (field.id === 'telefono') {
            const telefonoPattern = /^[0-9]{10}$/;
            if (!telefonoPattern.test(field.value)) {
                errorMessage = 'Formato inválido. Use 10 dígitos (ej: 3001234567)';
            }
        } else if (field.id === 'password') {
            if (field.value.length < 6) {
                errorMessage = 'La contraseña debe tener al menos 6 caracteres';
            }
        }

        // Mostrar error si existe
        if (errorMessage) {
            field.classList.add('input-error');
            if (errorSpan) errorSpan.textContent = errorMessage;
            return false;
        }

        return true;
    }

    // Agregar listeners a cada input
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });

        // Limpiar error al escribir
        input.addEventListener('input', function() {
            if (this.classList.contains('input-error')) {
                validateField(this);
            }
        });
    });

    // No hay campo placa: usamos teléfono

    // Validación al enviar formulario
    form.addEventListener('submit', function(e) {
        let isValid = true;

        inputs.forEach(input => {
            if (!validateField(input)) {
                isValid = false;
            }
        });

        if (!isValid) {
            e.preventDefault();
            // Scroll al primer error
            const firstError = form.querySelector('.input-error');
            if (firstError) {
                firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstError.focus();
            }
        }
    });

    // Auto-focus en el primer campo al cargar
    window.addEventListener('load', function() {
        // focus en teléfono
        const t = document.getElementById('telefono');
        if (t) t.focus();
    });
</script>

</body>
</html>